# Passport.js Authentication Demo

یک پروژه ساده Node.js با استفاده از Passport.js برای احرازهویت که برای تست‌های امنیتی طراحی شده است.

## ویژگی‌ها

- احرازهویت محلی با Passport.js
- مدیریت نشست با express-session
- رمزنگاری پسورد با bcryptjs
- کنترل دسترسی بر اساس نقش (admin/user)
- API endpoints برای تست
- ذخیره‌سازی ساده در حافظه (برای اهداف نمایشی)

## نصب و راه‌اندازی

1. نصب وابستگی‌ها:
```bash
npm install
```

2. اجرای برنامه:
```bash
npm start
```

یا برای توسعه:
```bash
npm run dev
```

3. باز کردن مرورگر و رفتن به:
```
http://localhost:3000
```

## حساب‌های تست

- **Admin**: username=`admin`, password=`admin123`
- **User**: username=`user`, password=`user123`

## مسیرهای موجود

### صفحات اصلی
- `/` - صفحه اصلی
- `/login` - صفحه ورود
- `/register` - صفحه ثبت‌نام
- `/dashboard` - داشبورد کاربر (نیاز به احرازهویت)
- `/admin` - پنل ادمین (نیاز به نقش admin)
- `/logout` - خروج

### API Endpoints
- `GET /api/users` - لیست کاربران (نیاز به احرازهویت)
- `GET /api/profile` - اطلاعات پروفایل کاربر (نیاز به احرازهویت)

## سناریوهای تست امنیتی

### 1. تست احرازهویت
- تست ورود با اطلاعات نادرست
- تست ورود با حساب‌های موجود
- تست دسترسی به صفحات محافظت شده بدون احرازهویت

### 2. تست کنترل دسترسی
- تست دسترسی به `/admin` با حساب کاربر عادی
- تست دسترسی به API endpoints بدون احرازهویت
- تست دسترسی به `/dashboard` بدون ورود

### 3. تست نشست
- تست اعتبار نشست پس از خروج
- تست دسترسی همزمان با چندین نشست
- تست تزریق نشست

### 4. تست ورودی
- تست SQL Injection (در صورت استفاده از دیتابیس)
- تست XSS در فرم‌ها
- تست CSRF

### 5. تست API
- تست دسترسی به `/api/users` بدون احرازهویت
- تست دسترسی به `/api/profile` بدون احرازهویت
- تست تغییر روش HTTP (GET به POST)

### 6. تست رمزنگاری
- تست پسوردهای ضعیف
- تست پسوردهای خالی
- تست پسوردهای طولانی

## ابزارهای تست امنیتی پیشنهادی

### ابزارهای دستی
- **Burp Suite** - برای تست API و پروکسی
- **OWASP ZAP** - برای اسکن خودکار
- **Postman** - برای تست API endpoints

### ابزارهای خط فرمان
- **curl** - برای تست API
- **wget** - برای تست صفحات
- **sqlmap** - برای تست SQL Injection

### مثال‌های تست با curl

```bash
# تست دسترسی به API بدون احرازهویت
curl http://localhost:3000/api/users

# تست ورود
curl -X POST http://localhost:3000/login \
  -d "username=admin&password=admin123" \
  -c cookies.txt

# تست دسترسی به API با کوکی
curl http://localhost:3000/api/users -b cookies.txt

# تست دسترسی به پنل ادمین
curl http://localhost:3000/admin -b cookies.txt
```

## نکات امنیتی

### مشکلات امنیتی موجود (عمدی برای تست)
1. **کلید نشست ثابت** - در تولید باید تصادفی باشد
2. **ذخیره‌سازی در حافظه** - در تولید باید از دیتابیس استفاده شود
3. **عدم استفاده از HTTPS** - در تولید باید فعال باشد
4. **عدم محدودیت نرخ درخواست** - در تولید باید Rate Limiting اعمال شود
5. **عدم اعتبارسنجی ورودی** - در تولید باید اعتبارسنجی کامل باشد

### بهبودهای پیشنهادی
1. استفاده از متغیرهای محیطی برای کلیدهای حساس
2. اضافه کردن Rate Limiting
3. اعتبارسنجی ورودی با Joi یا Yup
4. استفاده از دیتابیس واقعی
5. فعال‌سازی HTTPS
6. اضافه کردن CSRF Protection
7. اضافه کردن Helmet.js برای امنیت HTTP Headers

## ساختار پروژه

```
passport-auth-demo/
├── app.js          # فایل اصلی برنامه
├── package.json    # وابستگی‌ها و اسکریپت‌ها
└── README.md       # این فایل
```

## مجوز

MIT License